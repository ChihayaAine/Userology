# FoloUp代码修改需求文档

## 📋 修改概述
需要修改FoloUp项目中的数据传递逻辑，以支持分section的访谈结构，提升AI访谈的精准度。

## 🎯 修改目标
将当前的单一`questions`变量改为10个独立的`section1-section10`变量，让Retell AI能够按阶段执行结构化访谈，最大支持10个访谈阶段。

## 📁 需要修改的文件

### 文件1：`src/components/call/index.tsx`

**位置**：第199-204行

**当前代码**：
```javascript
const data = {
  mins: interview?.time_duration,
  objective: interview?.objective,
  questions: interview?.questions.map((q) => q.question).join(", "),
  name: name || "not provided",
};
```

**修改为**：
```javascript
const data = {
  mins: interview?.time_duration,
  objective: interview?.objective,
  name: name || "not provided",
  
  // 新增：分Section传递（支持最大10个sections）
  section1: interview?.questions[0]?.question || "",
  section2: interview?.questions[1]?.question || "",
  section3: interview?.questions[2]?.question || "",
  section4: interview?.questions[3]?.question || "",
  section5: interview?.questions[4]?.question || "",
  section6: interview?.questions[5]?.question || "",
  section7: interview?.questions[6]?.question || "",
  section8: interview?.questions[7]?.question || "",
  section9: interview?.questions[8]?.question || "",
  section10: interview?.questions[9]?.question || "",
  
  // 保留原有questions变量（向后兼容）
  questions: interview?.questions.map((q) => q.question).join(", "),
};
```

## ✅ 修改验证方法

### 1. 代码验证
修改完成后，请确认：
- [ ] 代码能够正常编译，无语法错误
- [ ] 保留了原有的`questions`变量（确保向后兼容）
- [ ] 新增的10个section变量使用了`|| ""`作为默认值

### 2. 功能验证
请创建测试用例验证：

#### 测试用例1：3个问题的访谈
```
问题1: "您为什么需要考多益？"
问题2: "目前备考遇到什么困难？"
问题3: "理想的备考产品是什么样？"
```

**期望结果**：
- `section1` = "您为什么需要考多益？"
- `section2` = "目前备考遇到什么困难？"
- `section3` = "理想的备考产品是什么样？"
- `section4` = ""
- `section5` = ""
- `section6` = ""
- `section7` = ""
- `section8` = ""
- `section9` = ""
- `section10` = ""

#### 测试用例2：10个问题的访谈
创建10个问题的访谈，确认所有section变量都正确赋值。

#### 测试用例3：超过10个问题的访谈
创建12个问题的访谈，确认只有前10个被赋值给section1-section10。

### 3. 数据传递验证
请在浏览器开发者工具中检查：
1. 打开Network标签
2. 发起访谈通话
3. 查看`/api/register-call`请求的payload
4. 确认包含了`section1-section10`字段

**正确的payload应该类似**：
```json
{
  "dynamic_data": {
    "mins": "30",
    "objective": "了解多益备考需求",
    "name": "张三",
    "section1": "您为什么需要考多益？",
    "section2": "目前备考遇到什么困难？",
    "section3": "理想的备考产品是什么样？",
    "section4": "",
    "section5": "",
    "section6": "",
    "section7": "",
    "section8": "",
    "section9": "",
    "section10": "",
    "questions": "您为什么需要考多益？, 目前备考遇到什么困难？, 理想的备考产品是什么样？"
  },
  "interviewer_id": 123
}
```

## ⚠️ 重要注意事项

### 1. 向后兼容性
- **必须保留**原有的`questions`变量
- 确保现有的访谈不会受到影响
- 新老版本的Agent都能正常工作

### 2. 错误处理
- 使用`?.`操作符防止空指针错误
- 使用`|| ""`提供空字符串默认值
- 确保数组越界时不会崩溃

### 3. 测试覆盖
请测试以下场景：
- 用户创建1个问题
- 用户创建5个问题
- 用户创建10个问题
- 用户创建超过10个问题（应该只取前10个）
- 数据加载失败的情况

## 📞 沟通要点

### 对外包团队说明：
1. **这是一个小的增强功能**，不是大改动
2. **风险很低**，只是增加新的数据字段
3. **保持向后兼容**，不会破坏现有功能
4. **预估工作量**：1-2小时完成修改和测试

### 如果外包团队有疑问：
- **Q: 为什么需要10个section变量？**
  - A: 为了支持结构化访谈，让AI能够按阶段执行不同的访谈策略，最大支持10个阶段

- **Q: 如果用户创建超过10个问题怎么办？**
  - A: 只取前10个，这是当前的设计限制

- **Q: 这会影响现有的访谈吗？**
  - A: 不会，我们保留了原有的questions变量，确保向后兼容

## 🚀 交付要求

### 1. 代码交付
- 提供修改后的`src/components/call/index.tsx`文件
- 确保代码通过所有现有测试

### 2. 测试报告
- 提供上述3个测试用例的验证截图
- 确认Network请求中包含了正确的section数据

### 3. 部署确认
- 在测试环境部署并验证功能正常
- 提供测试访谈的链接供我们验证

## 📅 时间安排
- **修改时间**：收到需求后24小时内完成
- **测试时间**：修改完成后12小时内提供测试结果
- **部署时间**：测试通过后24小时内部署到生产环境

---

**联系方式**：如有任何疑问，请及时联系我们进行澄清