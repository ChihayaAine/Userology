# ä¸¤æ­¥å¤§çº²ç”Ÿæˆç³»ç»Ÿ - å®Œæ•´å®ç°è§„åˆ’

> **ç‰ˆæœ¬**: 1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-10-28  
> **çŠ¶æ€**: è§„åˆ’ä¸­

---

## ğŸ¯ ç›®æ ‡

å°†å½“å‰çš„ä¸€æ­¥å¤§çº²ç”Ÿæˆæµç¨‹æ‹†åˆ†ä¸ºä¸¤æ­¥ï¼š

1. **Step 1: ç”Ÿæˆéª¨æ¶** - ç”Ÿæˆ Session ä¸»é¢˜ã€ç›®æ ‡ã€èƒŒæ™¯ä¿¡æ¯
2. **Step 2: ç”Ÿæˆå®Œæ•´å¤§çº²** - åŸºäºéª¨æ¶ç”Ÿæˆå…·ä½“é—®é¢˜å’Œè¿½é—®ç­–ç•¥

**æ ¸å¿ƒæ”¹è¿›**ï¼š
- âœ… è§£å†³ Prompt ä¿¡æ¯è¿‡è½½é—®é¢˜ï¼ˆ350 è¡Œ â†’ æ‹†åˆ†ä¸ºä¸¤ä¸ª 150 è¡Œçš„ Promptï¼‰
- âœ… ç”Ÿæˆæ›´å…·ä½“ã€å¯æ“ä½œçš„èƒŒæ™¯ä¿¡æ¯ï¼ˆè€ŒéæŠ½è±¡æè¿°ï¼‰
- âœ… ä¸ºå…³é”®é—®é¢˜ç”Ÿæˆè¿½é—®ç­–ç•¥
- âœ… å…è®¸ç”¨æˆ·åœ¨éª¨æ¶é˜¶æ®µ review å’Œç¼–è¾‘

---

## ğŸ“Š æ•°æ®åº“æ¶æ„è®¾è®¡

### æ–°å¢å­—æ®µ

```sql
-- åœ¨ interview è¡¨ä¸­æ·»åŠ å­—æ®µ
ALTER TABLE interview 
ADD COLUMN IF NOT EXISTS outline_skeleton JSONB,
ADD COLUMN IF NOT EXISTS outline_generation_status VARCHAR(50) DEFAULT 'draft',
ADD COLUMN IF NOT EXISTS skeleton_generated_at TIMESTAMP,
ADD COLUMN IF NOT EXISTS skeleton_reviewed_at TIMESTAMP,
ADD COLUMN IF NOT EXISTS draft_generated_at TIMESTAMP,
ADD COLUMN IF NOT EXISTS localized_at TIMESTAMP;

-- æ·»åŠ æ³¨é‡Š
COMMENT ON COLUMN interview.outline_skeleton IS 'å¤§çº²éª¨æ¶ï¼ˆSession ä¸»é¢˜ã€ç›®æ ‡ã€èƒŒæ™¯ä¿¡æ¯ï¼‰';
COMMENT ON COLUMN interview.outline_generation_status IS 'å¤§çº²ç”ŸæˆçŠ¶æ€ï¼šdraft, skeleton_generated, skeleton_reviewed, draft_generated, localized';
COMMENT ON COLUMN interview.skeleton_generated_at IS 'éª¨æ¶ç”Ÿæˆæ—¶é—´';
COMMENT ON COLUMN interview.skeleton_reviewed_at IS 'éª¨æ¶å®¡æ ¸æ—¶é—´';
COMMENT ON COLUMN interview.draft_generated_at IS 'åˆç¨¿å¤§çº²ç”Ÿæˆæ—¶é—´';
COMMENT ON COLUMN interview.localized_at IS 'æœ¬åœ°åŒ–å®Œæˆæ—¶é—´';
```

### æ•°æ®ç»“æ„

```typescript
// OutlineSkeleton ç»“æ„
interface OutlineSkeleton {
  sessions: SkeletonSession[];
  metadata: {
    total_sessions: number;
    estimated_duration_minutes: number;
    draft_language: string;
  };
}

interface SkeletonSession {
  session_number: number;
  session_title: string;
  session_goal: string;
  background_information: string[];
}

// ç”ŸæˆçŠ¶æ€æšä¸¾
type OutlineGenerationStatus = 
  | 'draft'                // åˆå§‹çŠ¶æ€
  | 'skeleton_generated'   // éª¨æ¶å·²ç”Ÿæˆ
  | 'skeleton_reviewed'    // éª¨æ¶å·²å®¡æ ¸
  | 'draft_generated'      // åˆç¨¿å¤§çº²å·²ç”Ÿæˆ
  | 'localized';           // å·²æœ¬åœ°åŒ–
```

---

## ğŸ”„ å®Œæ•´æ•°æ®æµç¨‹

```
ç”¨æˆ·å¡«å†™ Study Objective å’Œ Context
  â†“
ç‚¹å‡»"ç”Ÿæˆå¤§çº²éª¨æ¶"
  â†“
è°ƒç”¨ POST /api/outlines/skeleton
  â†“
ä¿å­˜éª¨æ¶åˆ° interview.outline_skeleton
  â†“
åœ¨åŒä¸€é¡µé¢æ˜¾ç¤ºéª¨æ¶ï¼ˆSession å¡ç‰‡ï¼‰
  â†“
ç”¨æˆ· Review å’Œç¼–è¾‘éª¨æ¶
  â†“
è°ƒç”¨ PATCH /api/outlines/:id/skeletonï¼ˆä¿å­˜ç¼–è¾‘ï¼‰
  â†“
ç”¨æˆ·ç‚¹å‡»"ç¡®è®¤å¹¶ç”Ÿæˆå®Œæ•´å¤§çº²"
  â†“
è°ƒç”¨ POST /api/outlines/:id/confirm-skeleton
  â†“
è°ƒç”¨ POST /api/outlines/:id/full-outline
  â†“
ä¿å­˜å®Œæ•´å¤§çº²åˆ° interview.draft_outline
  â†“
è·³è½¬åˆ°ç¼–è¾‘å¤§çº²é¡µé¢
```

---

## ğŸ“ Prompt è®¾è®¡

### Step 1: ç”Ÿæˆéª¨æ¶ Prompt

**æ–‡ä»¶**: `backend/src/lib/prompts/generate-outline-skeleton.ts`

**æ ¸å¿ƒè¦æ±‚**ï¼š
1. ç”Ÿæˆ Session ä¸»é¢˜å’Œç›®æ ‡
2. ç”Ÿæˆ**å…·ä½“ã€å¯æ“ä½œ**çš„èƒŒæ™¯ä¿¡æ¯ï¼ˆå¸¦æ•°æ®ã€äº‹å®ã€æ´å¯Ÿï¼‰
3. è¯†åˆ«å¿…é—®é¡¹ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼Œä¸æ˜¾ç¤ºç»™ç”¨æˆ·ï¼‰

**è¾“å‡ºæ ¼å¼**ï¼š
```json
{
  "sessions": [
    {
      "session_number": 1,
      "session_title": "ç ´å†°ä¸èƒŒæ™¯å»ºç«‹",
      "session_goal": "å»ºç«‹è®¿è°ˆå…³ç³»å¹¶æ”¶é›†ç”¨æˆ·è‹±è¯­å­¦ä¹ èƒŒæ™¯...",
      "background_information": [
        "æ³•å›½ä¸»è¦è‹±è¯­è€ƒè¯•åŒ…æ‹¬TOEICï¼ˆèŒåœºè®¤å¯åº¦æœ€é«˜ï¼‰ã€TOEFL/IELTSï¼ˆç•™å­¦å¿…å¤‡ï¼‰",
        "æ³•å›½å­¦ç”Ÿè‹±è¯­å®é™…åº”ç”¨èƒ½åŠ›æ™®éåå¼±ï¼Œçº¦50%åˆä¸­æ¯•ä¸šç”Ÿæœªè¾¾A2ç­‰çº§",
        "è‹±è¯­èƒ½åŠ›å­˜åœ¨æ˜¾è‘—åœ°åŸŸå·®å¼‚ï¼Œå·´é»åœ°åŒº42%å…·å¤‡æ²Ÿé€šèƒ½åŠ›ï¼Œä¹¡æ‘åœ°åŒºä»…18%"
      ]
    }
  ]
}
```

### Step 2: ç”Ÿæˆå®Œæ•´å¤§çº² Prompt

**æ–‡ä»¶**: `backend/src/lib/prompts/generate-full-outline-from-skeleton.ts`

**æ ¸å¿ƒè¦æ±‚**ï¼š
1. åŸºäºéª¨æ¶ç”Ÿæˆ 4-6 ä¸ªå…·ä½“é—®é¢˜ï¼ˆä½¿ç”¨æ¼æ–—æ–¹æ³•ï¼‰
2. ä¸ºå…³é”®é—®é¢˜ç”Ÿæˆè¿½é—®ç­–ç•¥
3. ç”Ÿæˆ Session 1 Openingï¼ˆ6 ä¸ªå…ƒç´ ï¼‰
4. ç”Ÿæˆ Session ä¹‹é—´çš„è¿‡æ¸¡

**è¾“å…¥**ï¼š
- ç”¨æˆ·å®¡æ ¸åçš„éª¨æ¶
- åŸå§‹çš„ Study Objective å’Œ Context

**è¾“å‡ºæ ¼å¼**ï¼š
```json
{
  "questions": [
    "### **Session 1: ç ´å†°ä¸èƒŒæ™¯å»ºç«‹**\n\n**Session Goal:** ...\n\n**Section Notes:**\n- **Interviewer Instructions:** ...\n- **Background Information:** [ä½¿ç”¨éª¨æ¶ä¸­çš„èƒŒæ™¯ä¿¡æ¯]\n\n**Interview Outline:**\n\n**[Opening]**\n[6 ä¸ªå…ƒç´ çš„å®Œæ•´ Opening]\n\nQ1.1 ...\nQ1.2 ...\n...\n\n**[Transition to Next Session]**\n..."
  ],
  "description": "50-word description"
}
```

---

## ğŸ› ï¸ Backend API å®ç°

### 1. POST /api/outlines/skeleton

**æ–‡ä»¶**: `backend/src/controllers/questions.controller.ts`

**åŠŸèƒ½**: ç”Ÿæˆå¤§çº²éª¨æ¶

**è¯·æ±‚**:
```typescript
{
  interview_id: string;
  session_count: number;
  duration_minutes: number;
  draft_language: string;
}
```

**å“åº”**:
```typescript
{
  skeleton: OutlineSkeleton;
  status: 'skeleton_generated';
}
```

**å®ç°é€»è¾‘**:
```typescript
export const generateOutlineSkeleton = async (req: Request, res: Response) => {
  const { interview_id, session_count, duration_minutes, draft_language } = req.body;
  
  // 1. è·å– interview çš„ objective å’Œ context
  const interview = await InterviewService.getInterviewById(interview_id);
  
  // 2. è°ƒç”¨ Step 1 Prompt ç”Ÿæˆéª¨æ¶
  const skeleton = await callOpenAI({
    prompt: generateSkeletonPrompt({
      objective: interview.objective,
      context: interview.context,
      session_count,
      duration_minutes,
      language: draft_language
    })
  });
  
  // 3. ä¿å­˜éª¨æ¶åˆ°æ•°æ®åº“
  await InterviewService.updateInterview({
    outline_skeleton: skeleton,
    outline_generation_status: 'skeleton_generated',
    skeleton_generated_at: new Date(),
    outline_debug_language: draft_language
  }, interview_id);
  
  res.json({ skeleton, status: 'skeleton_generated' });
};
```

### 2. PATCH /api/outlines/:id/skeleton

**åŠŸèƒ½**: æ›´æ–°éª¨æ¶ï¼ˆç”¨æˆ·ç¼–è¾‘åï¼‰

**è¯·æ±‚**:
```typescript
{
  skeleton: OutlineSkeleton;
}
```

### 3. POST /api/outlines/:id/confirm-skeleton

**åŠŸèƒ½**: ç¡®è®¤éª¨æ¶ï¼ˆæ ‡è®°ä¸ºå·²å®¡æ ¸ï¼‰

**å®ç°**:
```typescript
await InterviewService.updateInterview({
  outline_generation_status: 'skeleton_reviewed',
  skeleton_reviewed_at: new Date()
}, interview_id);
```

### 4. POST /api/outlines/:id/full-outline

**åŠŸèƒ½**: åŸºäºéª¨æ¶ç”Ÿæˆå®Œæ•´å¤§çº²

**å®ç°é€»è¾‘**:
```typescript
export const generateFullOutlineFromSkeleton = async (req: Request, res: Response) => {
  const { id } = req.params;
  
  // 1. è·å–éª¨æ¶å’Œ interview ä¿¡æ¯
  const interview = await InterviewService.getInterviewById(id);
  
  if (interview.outline_generation_status !== 'skeleton_reviewed') {
    throw new Error('Skeleton must be reviewed before generating full outline');
  }
  
  // 2. è°ƒç”¨ Step 2 Prompt ç”Ÿæˆå®Œæ•´å¤§çº²
  const fullOutline = await callOpenAI({
    prompt: generateFullOutlinePrompt({
      skeleton: interview.outline_skeleton,
      objective: interview.objective,
      context: interview.context
    })
  });
  
  // 3. ä¿å­˜å®Œæ•´å¤§çº²
  await InterviewService.updateInterview({
    draft_outline: fullOutline.questions,
    description: fullOutline.description,
    outline_generation_status: 'draft_generated',
    draft_generated_at: new Date()
  }, id);
  
  res.json({ draft_outline: fullOutline.questions, status: 'draft_generated' });
};
```

---

## ğŸ¨ Frontend UI é‡æ„

### é¡µé¢æµç¨‹å˜åŒ–

**æ—§æµç¨‹**:
```
ç”Ÿæˆå¤§çº²é¡µé¢ (outline/page.tsx)
  â†“ ç‚¹å‡»"ç”Ÿæˆå¤§çº²"
  â†“ ç›´æ¥ç”Ÿæˆå®Œæ•´å¤§çº²
  â†“ è·³è½¬åˆ°ç¼–è¾‘å¤§çº²é¡µé¢ (edit-outline/page.tsx)
```

**æ–°æµç¨‹**:
```
ç”Ÿæˆå¤§çº²é¡µé¢ (outline/page.tsx)
  â†“ ç‚¹å‡»"ç”Ÿæˆå¤§çº²éª¨æ¶"
  â†“ åœ¨åŒä¸€é¡µé¢æ˜¾ç¤ºéª¨æ¶ï¼ˆSession å¡ç‰‡ï¼‰
  â†“ ç”¨æˆ· Review å’Œç¼–è¾‘
  â†“ ç‚¹å‡»"ç¡®è®¤å¹¶ç”Ÿæˆå®Œæ•´å¤§çº²"
  â†“ ç”Ÿæˆå®Œæ•´å¤§çº²
  â†“ è·³è½¬åˆ°ç¼–è¾‘å¤§çº²é¡µé¢ (edit-outline/page.tsx)
```

### ç»„ä»¶è®¾è®¡

#### 1. SessionCard ç»„ä»¶

**æ–‡ä»¶**: `frontend/src/components/dashboard/interview/create-popup/SessionCard.tsx`

**åŠŸèƒ½**: æ˜¾ç¤ºå’Œç¼–è¾‘å•ä¸ª Session çš„éª¨æ¶

**Props**:
```typescript
interface SessionCardProps {
  session: SkeletonSession;
  onEdit: (updates: Partial<SkeletonSession>) => void;
  onDelete: () => void;
}
```

**UI ç»“æ„**:
```tsx
<div className="border rounded-lg p-6 bg-white shadow-sm">
  {/* Session ç¼–å·å’Œæ ‡é¢˜ */}
  <div className="flex items-center justify-between mb-4">
    <div className="flex items-center gap-3">
      <div className="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center">
        {session.session_number}
      </div>
      <input 
        value={session.session_title}
        onChange={(e) => onEdit({ session_title: e.target.value })}
        className="text-lg font-semibold"
      />
    </div>
    <button onClick={onDelete}>åˆ é™¤</button>
  </div>
  
  {/* Session ç›®æ ‡ */}
  <div className="mb-4">
    <label className="text-sm font-medium text-gray-700">ğŸ¯ Session ç›®æ ‡</label>
    <textarea 
      value={session.session_goal}
      onChange={(e) => onEdit({ session_goal: e.target.value })}
      className="w-full mt-2"
    />
  </div>
  
  {/* èƒŒæ™¯ä¿¡æ¯ */}
  <div>
    <div className="flex items-center justify-between mb-2">
      <label className="text-sm font-medium text-gray-700">
        ğŸ“š èƒŒæ™¯ä¿¡æ¯ ({session.background_information.length} æ¡)
      </label>
      <button onClick={toggleExpand}>
        {isExpanded ? 'æ”¶èµ·' : 'å±•å¼€ç¼–è¾‘'}
      </button>
    </div>
    
    {isExpanded && (
      <div className="space-y-2">
        {session.background_information.map((info, index) => (
          <div key={index} className="flex gap-2">
            <input 
              value={info}
              onChange={(e) => handleEditBackground(index, e.target.value)}
              className="flex-1"
            />
            <button onClick={() => handleDeleteBackground(index)}>åˆ é™¤</button>
          </div>
        ))}
        <button onClick={handleAddBackground}>+ æ·»åŠ èƒŒæ™¯</button>
      </div>
    )}
  </div>
</div>
```

---

## ğŸ“± å‰ç«¯çŠ¶æ€ç®¡ç†

### Zustand Store æ‰©å±•

**æ–‡ä»¶**: `frontend/src/store/interview-store.ts`

**æ–°å¢çŠ¶æ€**:
```typescript
interface InterviewStore {
  // ... ç°æœ‰å­—æ®µ

  // éª¨æ¶ç›¸å…³
  outlineSkeleton: OutlineSkeleton | null;
  setOutlineSkeleton: (skeleton: OutlineSkeleton | null) => void;
  outlineGenerationStatus: OutlineGenerationStatus;
  setOutlineGenerationStatus: (status: OutlineGenerationStatus) => void;
}
```

---

## ğŸ¨ è¯¦ç»† UI æµç¨‹è®¾è®¡

### ç”Ÿæˆå¤§çº²é¡µé¢ (outline/page.tsx)

**å½“å‰çŠ¶æ€**: ç”¨æˆ·å¡«å†™å®Œ Study Objective åï¼Œç‚¹å‡»"ç”Ÿæˆå¤§çº²"ç›´æ¥ç”Ÿæˆå®Œæ•´å¤§çº²å¹¶è·³è½¬

**æ–°æµç¨‹**:

#### é˜¶æ®µ 1: å¡«å†™åŸºæœ¬ä¿¡æ¯
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”Ÿæˆè®¿è°ˆå¤§çº²                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Session æ•°é‡: [6]                                            â”‚
â”‚  è®¿è°ˆæ—¶é•¿: [45] åˆ†é’Ÿ                                          â”‚
â”‚  åˆç¨¿è¯­è¨€: [ä¸­æ–‡ â–¼]                                           â”‚
â”‚                                                               â”‚
â”‚  [ç”Ÿæˆå¤§çº²éª¨æ¶]                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é˜¶æ®µ 2: æ˜¾ç¤ºéª¨æ¶ï¼ˆç‚¹å‡»"ç”Ÿæˆå¤§çº²éª¨æ¶"åï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”Ÿæˆè®¿è°ˆå¤§çº²                                    [é‡æ–°ç”Ÿæˆéª¨æ¶] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  âœ… éª¨æ¶å·²ç”Ÿæˆ - è¯· Review å¹¶ç¼–è¾‘                             â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â‘  Session 1: ç ´å†°ä¸èƒŒæ™¯å»ºç«‹              [ç¼–è¾‘] [åˆ é™¤] â”‚ â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ â”‚
â”‚  â”‚  ğŸ¯ Session ç›®æ ‡:                                       â”‚ â”‚
â”‚  â”‚  å»ºç«‹è®¿è°ˆå…³ç³»å¹¶æ”¶é›†ç”¨æˆ·è‹±è¯­å­¦ä¹ èƒŒæ™¯...                 â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  ğŸ“š èƒŒæ™¯ä¿¡æ¯ (4 æ¡) â–¼                    [å±•å¼€ç¼–è¾‘]     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ æ³•å›½ä¸»è¦è‹±è¯­è€ƒè¯•åŒ…æ‹¬TOEIC...                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ æ³•å›½å­¦ç”Ÿè‹±è¯­å®é™…åº”ç”¨èƒ½åŠ›æ™®éåå¼±...            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ è‹±è¯­èƒ½åŠ›å­˜åœ¨æ˜¾è‘—åœ°åŸŸå·®å¼‚...                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ ç”¨æˆ·åå¥½ä¸¥è‚ƒä¸“ä¸šçš„å­¦ä¹ å·¥å…·...   [+ æ·»åŠ èƒŒæ™¯]  â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â‘¡ Session 2: æ·±å…¥æ¢ç´¢å­¦ä¹ ç—›ç‚¹            [ç¼–è¾‘] [åˆ é™¤] â”‚ â”‚
â”‚  â”‚  ...                                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  [+ æ·»åŠ æ–° Session]                                           â”‚
â”‚                                                               â”‚
â”‚  [ä¸Šä¸€æ­¥]                    [ç¡®è®¤å¹¶ç”Ÿæˆå®Œæ•´å¤§çº²]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é˜¶æ®µ 3: ç”Ÿæˆå®Œæ•´å¤§çº²ï¼ˆç‚¹å‡»"ç¡®è®¤å¹¶ç”Ÿæˆå®Œæ•´å¤§çº²"åï¼‰
```
æ˜¾ç¤º Loading çŠ¶æ€ â†’ ç”Ÿæˆå®Œæ•´å¤§çº² â†’ è·³è½¬åˆ°ç¼–è¾‘å¤§çº²é¡µé¢
```

### å…³é”®äº¤äº’é€»è¾‘

**1. ç”Ÿæˆéª¨æ¶æŒ‰é’®**
```typescript
const handleGenerateSkeleton = async () => {
  setIsGenerating(true);

  try {
    const response = await apiClient.post('/api/outlines/skeleton', {
      interview_id: interviewId,
      session_count: numQuestions,
      duration_minutes: duration,
      draft_language: localOutlineDebugLanguage
    });

    setOutlineSkeleton(response.data.skeleton);
    setOutlineGenerationStatus('skeleton_generated');
    toast.success("éª¨æ¶ç”ŸæˆæˆåŠŸï¼è¯· Review å¹¶ç¼–è¾‘");
  } catch (error) {
    toast.error("ç”Ÿæˆéª¨æ¶å¤±è´¥");
  } finally {
    setIsGenerating(false);
  }
};
```

**2. ç¼–è¾‘éª¨æ¶**
```typescript
const handleEditSession = async (sessionIndex: number, updates: Partial<SkeletonSession>) => {
  const updatedSkeleton = {
    ...outlineSkeleton,
    sessions: outlineSkeleton.sessions.map((s, i) =>
      i === sessionIndex ? { ...s, ...updates } : s
    )
  };

  setOutlineSkeleton(updatedSkeleton);

  // è‡ªåŠ¨ä¿å­˜åˆ°åç«¯
  await apiClient.patch(`/api/outlines/${interviewId}/skeleton`, {
    skeleton: updatedSkeleton
  });
};
```

**3. ç¡®è®¤å¹¶ç”Ÿæˆå®Œæ•´å¤§çº²**
```typescript
const handleConfirmAndGenerate = async () => {
  setIsGenerating(true);

  try {
    // 1. ç¡®è®¤éª¨æ¶
    await apiClient.post(`/api/outlines/${interviewId}/confirm-skeleton`);

    // 2. ç”Ÿæˆå®Œæ•´å¤§çº²
    const response = await apiClient.post(`/api/outlines/${interviewId}/full-outline`);

    setDraftQuestions(response.data.draft_outline);
    setOutlineGenerationStatus('draft_generated');

    // 3. è·³è½¬åˆ°ç¼–è¾‘å¤§çº²é¡µé¢
    router.push('/dashboard/create-interview/edit-outline');
  } catch (error) {
    toast.error("ç”Ÿæˆå®Œæ•´å¤§çº²å¤±è´¥");
  } finally {
    setIsGenerating(false);
  }
};
```

---

## ğŸ”„ å‘åå…¼å®¹æ€§

### æ•°æ®è¿ç§»

```sql
-- ä¸ºç°æœ‰æ•°æ®è®¾ç½®é»˜è®¤çŠ¶æ€
UPDATE interview 
SET outline_generation_status = 'draft_generated',
    draft_generated_at = created_at
WHERE draft_outline IS NOT NULL 
  AND outline_generation_status IS NULL;
```

### å‰ç«¯å…¼å®¹é€»è¾‘

```typescript
// æ£€æŸ¥æ˜¯å¦ä½¿ç”¨æ–°æµç¨‹
const useNewFlow = interview.outline_skeleton !== null;

if (useNewFlow) {
  // ä½¿ç”¨ä¸¤æ­¥ç”Ÿæˆæµç¨‹
} else {
  // ä½¿ç”¨æ—§æµç¨‹ï¼ˆç›´æ¥ç”Ÿæˆå®Œæ•´å¤§çº²ï¼‰
}
```

---

## ğŸ“‹ å®æ–½è®¡åˆ’

### Phase 1: æ•°æ®åº“å’Œç±»å‹å®šä¹‰
- [ ] åˆ›å»ºè¿ç§»è„šæœ¬
- [ ] æ›´æ–° TypeScript ç±»å‹
- [ ] æµ‹è¯•å‘åå…¼å®¹æ€§

### Phase 2: Backend Prompts
- [ ] åˆ›å»º Step 1 Promptï¼ˆç”Ÿæˆéª¨æ¶ï¼‰
- [ ] åˆ›å»º Step 2 Promptï¼ˆç”Ÿæˆå®Œæ•´å¤§çº²ï¼‰
- [ ] æµ‹è¯• Prompt è´¨é‡

### Phase 3: Backend API
- [ ] å®ç° 4 ä¸ªæ–° Endpoint
- [ ] æµ‹è¯• API åŠŸèƒ½

### Phase 4: Frontend UI
- [ ] åˆ›å»º SessionCard ç»„ä»¶
- [ ] ä¿®æ”¹ç”Ÿæˆå¤§çº²é¡µé¢
- [ ] å®ç°éª¨æ¶ç¼–è¾‘é€»è¾‘
- [ ] æµ‹è¯•å®Œæ•´æµç¨‹

### Phase 5: æµ‹è¯•å’Œä¼˜åŒ–
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–

---

**ç»´æŠ¤è€…**: Userology å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-10-28

