# è·¨è®¿è°ˆæ´å¯Ÿç”Ÿæˆç³»ç»Ÿ

> **ç‰ˆæœ¬**: 1.4.5
> **æœ€åæ›´æ–°**: 2025-10-31

---

## ğŸ“– ç³»ç»Ÿæ¦‚è¿°

è·¨è®¿è°ˆæ´å¯Ÿç”Ÿæˆç³»ç»Ÿ (Study Summary) è´Ÿè´£ä»å¤šä¸ªè®¿è°ˆä¸­æå–ç»¼åˆæ´å¯Ÿï¼Œè¯†åˆ«æ¨¡å¼å’Œè¶‹åŠ¿ã€‚ç³»ç»Ÿé‡‡ç”¨ä¸¤é˜¶æ®µ AI ç”Ÿæˆæ¶æ„ï¼š

1. **é˜¶æ®µ 1**: åˆ†æç ”ç©¶ç›®æ ‡ï¼Œæå–é¢„æœŸäº¤ä»˜ç‰©ç±»å‹
2. **é˜¶æ®µ 2**: æ ¹æ®äº¤ä»˜ç‰©ç±»å‹ç”Ÿæˆå®šåˆ¶åŒ–å†…å®¹

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### ä¸¤é˜¶æ®µç”Ÿæˆæµç¨‹

```
å¤šä¸ªè®¿è°ˆæ•°æ®
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 1: åˆ†æç ”ç©¶ç›®æ ‡                â”‚
â”‚  - è¯†åˆ«äº¤ä»˜ç‰©ç±»å‹                    â”‚
â”‚  - æå–å…³é”®ç»´åº¦                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 2: ç”Ÿæˆå®šåˆ¶åŒ–å†…å®¹              â”‚
â”‚  - Executive Summary                â”‚
â”‚  - Objective Deliverables           â”‚
â”‚  - Cross-Interview Insights         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ä¿å­˜åˆ° interview è¡¨
```

### æ ¸å¿ƒç»„ä»¶

- **Study Summary Service**: è·¨è®¿è°ˆåˆ†æé€»è¾‘
- **OpenAI GPT-4o**: AI åˆ†æå¼•æ“
- **Prompt Engineering**: ä¸¤é˜¶æ®µ Prompt è®¾è®¡

---

## ğŸ¯ æ•°æ®ç»“æ„

### Study Summary å®Œæ•´ç»“æ„

```typescript
{
  executive_summary: string;           // æ‰§è¡Œæ‘˜è¦
  objective_deliverables: {            // ç›®æ ‡äº¤ä»˜ç‰©
    type: string;                      // ç±»å‹
    content: any;                      // åŠ¨æ€å†…å®¹
  };
  cross_interview_insights: Array<{    // è·¨è®¿è°ˆæ´å¯Ÿ
    id: string;
    title: string;
    description: string;
    category: 'consensus' | 'divergent' | 'unexpected' | 'critical';
    importance: 'high' | 'medium' | 'low';
    user_count: string;                // "4 out of 5 users"
    supporting_quotes: Array<{
      user: string;
      quote: string;
      interview_id: string;
      timestamp: number;
    }>;
  }>;
}
```

---

## ğŸ”§ å®ç°ç»†èŠ‚

### Study Summary Service

**æ–‡ä»¶**: `backend/src/services/study-summary.service.ts`

**æ ¸å¿ƒå‡½æ•°**: `generateStudySummary`

```typescript
export const generateStudySummary = async (payload: {
  interviewId: string;
  selectedCallIds?: string[];
  regenerate?: boolean;
}) => {
  const { interviewId, selectedCallIds, regenerate = false } = payload;
  
  // 1. è·å–è®¿è°ˆæ•°æ®
  const interview = await InterviewService.getInterviewById(interviewId);
  
  // 2. æ£€æŸ¥ç¼“å­˜
  if (!regenerate && interview.executive_summary && interview.cross_interview_insights) {
    return { summary: { ... }, status: 200 };
  }
  
  // 3. è·å–æ‰€æœ‰ responses
  let responses = await ResponseService.getAllResponses(interviewId);
  
  // 4. è¿‡æ»¤æœ‰æ•ˆ responses
  if (selectedCallIds && selectedCallIds.length > 0) {
    responses = responses.filter(r => selectedCallIds.includes(r.call_id));
  }
  
  responses = responses.filter(r => 
    r.analytics && 
    r.candidate_status !== 'NOT_SELECTED' && 
    r.is_ended === true
  );
  
  // 5. é˜¶æ®µ 1: åˆ†æç ”ç©¶ç›®æ ‡
  const deliverableAnalysis = await analyzeStudyObjective(studyObjective);
  
  // 6. é˜¶æ®µ 2: ç”Ÿæˆå†…å®¹
  const studySummary = await generateStudyContent({
    studyObjective,
    deliverableType: deliverableAnalysis.type,
    responses,
    interview
  });
  
  // 7. ä¿å­˜åˆ°æ•°æ®åº“
  await InterviewService.updateInterview({
    executive_summary: studySummary.executive_summary,
    objective_deliverables: studySummary.objective_deliverables,
    cross_interview_insights: studySummary.cross_interview_insights
  }, interviewId);
  
  return { summary: studySummary, status: 200 };
};
```

---

### é˜¶æ®µ 1: åˆ†æç ”ç©¶ç›®æ ‡

**ç›®çš„**: è¯†åˆ«ç ”ç©¶ç›®æ ‡æœŸæœ›çš„äº¤ä»˜ç‰©ç±»å‹

**Prompt æ–‡ä»¶**: `backend/src/lib/prompts/generate-study-summary.ts`

**System Prompt**:
```
You are an expert research analyst specializing in identifying research objectives 
and expected deliverables from user research studies.
```

**User Prompt**:
```
Analyze this research objective and identify the expected deliverables:

## Study Objective
${studyObjective}

---

Identify:
1. Deliverable Type: action_plans, pricing_analysis, pain_points, general
2. Key Dimensions: What aspects to analyze
3. Priority Areas: What matters most
```

**å“åº”æ ¼å¼**:
```typescript
{
  type: 'action_plans' | 'pricing_analysis' | 'pain_points' | 'general';
  dimensions: string[];
  priorities: string[];
}
```

---

### é˜¶æ®µ 2: ç”Ÿæˆå®šåˆ¶åŒ–å†…å®¹

**ç›®çš„**: æ ¹æ®äº¤ä»˜ç‰©ç±»å‹ç”Ÿæˆå¯¹åº”çš„å†…å®¹ç»“æ„

#### ç±»å‹ 1: Action Plans (è¡ŒåŠ¨è®¡åˆ’)

**é€‚ç”¨åœºæ™¯**: äº§å“ä¼˜åŒ–ã€åŠŸèƒ½æ”¹è¿›

**å†…å®¹ç»“æ„**:
```typescript
{
  type: "action_plans",
  content: {
    immediate_actions: Array<{
      action: string;
      rationale: string;
      priority: 'high' | 'medium' | 'low';
      effort: 'low' | 'medium' | 'high';
      impact: 'low' | 'medium' | 'high';
    }>;
    long_term_recommendations: Array<{
      recommendation: string;
      rationale: string;
    }>;
  }
}
```

---

#### ç±»å‹ 2: Pricing Analysis (å®šä»·åˆ†æ)

**é€‚ç”¨åœºæ™¯**: å®šä»·ç­–ç•¥ç ”ç©¶

**å†…å®¹ç»“æ„**:
```typescript
{
  type: "pricing_analysis",
  content: {
    price_sensitivity: {
      acceptable_range: string;
      sweet_spot: string;
      resistance_points: string[];
    };
    value_perception: {
      perceived_value: string;
      comparison_to_competitors: string;
    };
    willingness_to_pay: {
      segments: Array<{
        segment: string;
        willingness: string;
        rationale: string;
      }>;
    };
  }
}
```

---

#### ç±»å‹ 3: Pain Points (ç—›ç‚¹åˆ†æ)

**é€‚ç”¨åœºæ™¯**: é—®é¢˜å‘ç°ã€éœ€æ±‚æŒ–æ˜

**å†…å®¹ç»“æ„**:
```typescript
{
  type: "pain_points",
  content: {
    critical_pain_points: Array<{
      pain_point: string;
      severity: 'high' | 'medium' | 'low';
      frequency: string;
      user_count: string;
    }>;
    underlying_causes: Array<{
      cause: string;
      related_pain_points: string[];
    }>;
  }
}
```

---

#### ç±»å‹ 4: General (é€šç”¨åˆ†æ)

**é€‚ç”¨åœºæ™¯**: ç»¼åˆæ€§ç ”ç©¶

**å†…å®¹ç»“æ„**:
```typescript
{
  type: "general",
  content: {
    key_findings: string[];
    patterns: string[];
    recommendations: string[];
  }
}
```

---

### Cross-Interview Insights

**ç›®çš„**: æå–è·¨è®¿è°ˆçš„å…±æ€§æ´å¯Ÿ

**æ´å¯Ÿç±»åˆ«**:

1. **consensus**: å¤šæ•°ç”¨æˆ·ä¸€è‡´çš„è§‚ç‚¹
2. **divergent**: ç”¨æˆ·é—´å­˜åœ¨åˆ†æ­§çš„è§‚ç‚¹
3. **unexpected**: æ„å¤–å‘ç°
4. **critical**: å…³é”®æ´å¯Ÿ

**ç”Ÿæˆé€»è¾‘**:
```typescript
// 1. æ”¶é›†æ‰€æœ‰è®¿è°ˆçš„ insights
const allInsights = responses.flatMap(r => r.insights_with_evidence || []);

// 2. èšç±»ç›¸ä¼¼æ´å¯Ÿ
const clusteredInsights = clusterSimilarInsights(allInsights);

// 3. æå–è·¨è®¿è°ˆæ¨¡å¼
const crossInterviewInsights = extractPatterns(clusteredInsights);

// 4. æ·»åŠ æ”¯æŒå¼•ç”¨
crossInterviewInsights.forEach(insight => {
  insight.supporting_quotes = findSupportingQuotes(insight, responses);
  insight.user_count = calculateUserCount(insight, responses);
});
```

---

## ğŸ“ Prompt å·¥ç¨‹

### Executive Summary Prompt

```
Based on ${responses.length} user interviews, generate an executive summary.

## Study Objective
${studyObjective}

## Deliverable Type
${deliverableType}

## Interview Data
${interviewSummaries}

---

Generate:
1. Executive Summary (2-3 paragraphs)
   - Key findings
   - Main patterns
   - Critical insights

2. Objective Deliverables (based on type: ${deliverableType})
   - Structured content matching the deliverable type

3. Cross-Interview Insights (5-8 insights)
   - Category: consensus, divergent, unexpected, critical
   - Importance: high, medium, low
   - Supporting quotes from multiple users
```

---

## ğŸ”„ æ•°æ®æµ

### å®Œæ•´ç”Ÿæˆæµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡» "Generate Study Insights"
   â†“
2. å‰ç«¯è°ƒç”¨ API
   POST /api/analytics/study-summary
   Body: { interviewId, selectedCallIds }
   â†“
3. åç«¯è·å–æ‰€æœ‰ responses
   - è¿‡æ»¤æœ‰æ•ˆæ•°æ®
   - æå– analytics å’Œ insights
   â†“
4. é˜¶æ®µ 1: åˆ†æç ”ç©¶ç›®æ ‡
   - è°ƒç”¨ OpenAI
   - è¯†åˆ«äº¤ä»˜ç‰©ç±»å‹
   â†“
5. é˜¶æ®µ 2: ç”Ÿæˆå†…å®¹
   - è°ƒç”¨ OpenAI
   - ç”Ÿæˆ Executive Summary
   - ç”Ÿæˆ Objective Deliverables
   - ç”Ÿæˆ Cross-Interview Insights
   â†“
6. ä¿å­˜åˆ°æ•°æ®åº“
   interview.executive_summary
   interview.objective_deliverables
   interview.cross_interview_insights
   â†“
7. è¿”å›å‰ç«¯æ˜¾ç¤º
```

---

## ğŸ’¾ æ•°æ®å­˜å‚¨

### Interview è¡¨å­—æ®µ

```sql
-- æ‰§è¡Œæ‘˜è¦
executive_summary TEXT

-- ç›®æ ‡äº¤ä»˜ç‰©
objective_deliverables JSONB

-- è·¨è®¿è°ˆæ´å¯Ÿ
cross_interview_insights JSONB

-- æ—§å­—æ®µï¼ˆå·²åºŸå¼ƒï¼‰
evidence_bank JSONB
```

---

## ğŸ”„ é‡æ–°ç”ŸæˆåŠŸèƒ½

### API ç«¯ç‚¹

```
POST /api/analytics/study-summary/regenerate
```

### å®ç°é€»è¾‘

```typescript
export const regenerateStudySummary = async (interviewId, selectedCallIds) => {
  // 1. æ¸…é™¤ç°æœ‰æ€»ç»“
  await InterviewService.updateInterview({
    executive_summary: null,
    objective_deliverables: null,
    cross_interview_insights: null,
    evidence_bank: null
  }, interviewId);
  
  // 2. é‡æ–°ç”Ÿæˆ
  return await generateStudySummary({ interviewId, selectedCallIds });
};
```

---

## ğŸ¨ å‰ç«¯é›†æˆ

### Study Insights é¡µé¢

**æ–‡ä»¶**: `frontend/src/app/interviews/[interviewId]/page.tsx`

**ç»„ä»¶**:
- Executive Summary å¡ç‰‡
- Objective Deliverables å¡ç‰‡
- Cross-Interview Insights åˆ—è¡¨
- Supporting Quotes å±•ç¤º

### ç”ŸæˆæŒ‰é’®

```typescript
const handleGenerateStudyInsights = async () => {
  setLoading(true);
  
  await apiClient.post('/analytics/study-summary', {
    interviewId,
    selectedCallIds: selectedResponses.map(r => r.call_id)
  });
  
  // åˆ·æ–°æ•°æ®...
  setLoading(false);
};
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### æ‰¹é‡å¤„ç†

- ä¸€æ¬¡æ€§è·å–æ‰€æœ‰ responses
- æ‰¹é‡æå– insights
- å•æ¬¡ AI è°ƒç”¨ç”Ÿæˆæ‰€æœ‰å†…å®¹

### ç¼“å­˜ç­–ç•¥

- æ£€æŸ¥ç°æœ‰æ€»ç»“ï¼Œé¿å…é‡å¤ç”Ÿæˆ
- æ”¯æŒå¢é‡æ›´æ–°ï¼ˆæ–°å¢è®¿è°ˆåé‡æ–°ç”Ÿæˆï¼‰

---

## ğŸ“Š è´¨é‡ä¿è¯

### æ´å¯Ÿè´¨é‡æ ‡å‡†

1. **è·¨è®¿è°ˆæ€§**: è‡³å°‘æ¥è‡ª 2 ä¸ªä»¥ä¸Šè®¿è°ˆ
2. **è¯æ®å……åˆ†**: æ¯ä¸ªæ´å¯Ÿæœ‰ 2-4 ä¸ªå¼•ç”¨
3. **ç”¨æˆ·è¦†ç›–**: æ ‡æ³¨å½±å“çš„ç”¨æˆ·æ•°é‡
4. **åˆ†ç±»å‡†ç¡®**: æ­£ç¡®è¯†åˆ« consensus/divergent/unexpected/critical

### äº¤ä»˜ç‰©è´¨é‡æ ‡å‡†

1. **ç±»å‹åŒ¹é…**: ä¸ç ”ç©¶ç›®æ ‡ä¸€è‡´
2. **ç»“æ„å®Œæ•´**: åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ
3. **å¯æ“ä½œæ€§**: æä¾›å…·ä½“å»ºè®®
4. **ä¼˜å…ˆçº§æ˜ç¡®**: æ ‡æ³¨é‡è¦æ€§å’Œç´§æ€¥æ€§

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è®¿è°ˆåˆ†æç³»ç»Ÿ](./05-è®¿è°ˆåˆ†æç³»ç»Ÿ.md)
- [æ•°æ®åº“è®¾è®¡](./02-æ•°æ®åº“è®¾è®¡.md)
- [æŠ€æœ¯æ¶æ„](./01-æŠ€æœ¯æ¶æ„.md)

---

**ç»´æŠ¤è€…**: Userology å¼€å‘å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2025-10-31

