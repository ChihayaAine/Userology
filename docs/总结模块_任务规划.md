# 访谈总结模块 - 任务规划

> 创建时间：2025-01-20  
> 当前状态：代码完成，开始执行和测试  
> 负责人：产品经理（有Supabase访问权限）

---

## 🎯 目标

完成访谈总结模块的部署和测试，使其在生产环境中正常运行。

---

## 📋 任务清单

### Phase 1: 数据库Migration ⚠️ **最高优先级**

#### Task 1.1: 执行Migration
**状态**: [ ] 待开始  
**预计时间**: 5分钟  
**阻塞**: 所有后续任务

**步骤**:
1. 打开Supabase Dashboard
2. 进入SQL Editor
3. 执行 `backend/migrations/001_add_summary_fields.sql`
4. 验证执行成功

**验证SQL**:
```sql
-- 应该返回6行
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name IN ('response', 'interview') 
  AND column_name IN (
    'key_insights', 
    'important_quotes', 
    'executive_summary', 
    'objective_deliverables', 
    'cross_interview_insights', 
    'evidence_bank'
  );
```

**成功标准**: 返回6行，每个字段一行

---

### Phase 2: 本地环境测试

#### Task 2.1: 启动服务
**状态**: [ ] 待开始  
**依赖**: Task 1.1  
**预计时间**: 5分钟

**步骤**:
```bash
# Terminal 1: 后端
cd backend && npm run dev

# Terminal 2: 前端
cd frontend && npm run dev
```

**验证**:
- [ ] 后端运行在 http://localhost:8090
- [ ] 前端运行在 http://localhost:8089
- [ ] 无启动错误

---

#### Task 2.2: 创建测试Study
**状态**: [ ] 待开始  
**依赖**: Task 2.1  
**预计时间**: 5分钟

**步骤**:
1. 访问 http://localhost:8089/dashboard
2. 点击 "Create New Study"
3. 填写信息：
   - Name: "Summary Feature Test"
   - Objective: "了解用户对AI写作工具的需求和痛点，生成3个产品改进建议"
   - Type: 产品调研
   - Questions: 5
   - Duration: 15分钟

**验证**:
- [ ] Study创建成功
- [ ] 可以看到访谈链接

---

#### Task 2.3: 进行测试访谈
**状态**: [ ] 待开始  
**依赖**: Task 2.2  
**预计时间**: 10分钟

**步骤**:
1. 复制Study的访谈链接
2. 在新标签页打开
3. 完成一次5-10分钟的访谈
4. 确保访谈正常结束

**验证**:
- [ ] 访谈正常进行
- [ ] 访谈正常结束
- [ ] Dashboard中可以看到访谈记录

---

#### Task 2.4: 验证单访谈自动生成
**状态**: [ ] 待开始  
**依赖**: Task 2.3  
**预计时间**: 5分钟

**步骤**:
1. 在Dashboard中点击Study
2. 点击访谈记录
3. 向下滚动查看总结部分

**验证**:
- [ ] 看到 "Key Insights" 卡片
- [ ] 看到 "Important Quotes" 卡片
- [ ] Key Insights有3-5条，带分类标签
- [ ] Important Quotes有5-10条，带时间戳
- [ ] UI样式正常

**如果没有生成**:
1. 检查后端日志，查找错误
2. 检查OpenAI API是否正常
3. 检查transcript是否存在

---

#### Task 2.5: 进行更多测试访谈
**状态**: [ ] 待开始  
**依赖**: Task 2.4  
**预计时间**: 20分钟

**步骤**:
在同一个Study中再进行2-3次访谈（可以快速测试，5分钟/次）

**验证**:
- [ ] 每次访谈都自动生成Key Insights和Important Quotes
- [ ] Study中有至少3个访谈记录

---

#### Task 2.6: 测试Study总结生成
**状态**: [ ] 待开始  
**依赖**: Task 2.5  
**预计时间**: 10分钟

**步骤**:
1. 访问Study页面
2. 点击 "Study Insights" Tab
3. 点击 "Generate Insights" 按钮
4. 等待生成（约30-60秒）

**验证**:
- [ ] "Generate Insights" 按钮正常工作
- [ ] 显示加载状态
- [ ] 生成成功后显示：
  - [ ] Executive Summary
  - [ ] Objective Deliverables（根据Objective动态生成）
  - [ ] Cross-Interview Insights（5-8条）
  - [ ] Evidence Bank（引用支持）
- [ ] Tabs切换正常

**如果生成失败**:
1. 检查后端日志
2. 确认有足够的访谈数据
3. 检查OpenAI API

---

#### Task 2.7: 测试编辑功能
**状态**: [ ] 待开始  
**依赖**: Task 2.6  
**预计时间**: 5分钟

**步骤**:
1. 在Study Insights页面，点击Executive Summary的编辑按钮
2. 修改内容
3. 点击保存
4. 刷新页面验证

**验证**:
- [ ] 编辑按钮正常
- [ ] 编辑模式切换正常
- [ ] 保存功能正常
- [ ] 取消功能正常
- [ ] 数据持久化

---

### Phase 3: 历史数据补充（可选）

#### Task 3.1: 为历史访谈生成总结
**状态**: [ ] 待开始  
**依赖**: Task 2.4  
**预计时间**: 10分钟

**步骤**:
```bash
cd backend

# 为"ai product" Study生成总结
npx tsx src/scripts/find-and-backfill.ts "ai product"
```

**验证**:
- [ ] 脚本成功运行
- [ ] 显示生成进度
- [ ] 显示成功/失败统计
- [ ] 历史访谈有了Key Insights和Important Quotes

**注意**:
- 短访谈（<2分钟）可能生成失败，这是正常的
- 可以多次运行，已有总结会跳过

---

### Phase 4: 边界情况测试

#### Task 4.1: 短访谈测试
**状态**: [ ] 待开始  
**预计时间**: 10分钟

**步骤**:
进行一次<2分钟的短访谈

**验证**:
- [ ] 可能生成1-2条insights，2-5条quotes
- [ ] 不应该报错或崩溃
- [ ] 显示友好的提示（如果生成失败）

---

#### Task 4.2: 单访谈Study测试
**状态**: [ ] 待开始  
**预计时间**: 10分钟

**步骤**:
创建一个只有1个访谈的Study，生成Study总结

**验证**:
- [ ] Study总结正常生成
- [ ] Cross-Interview Insights可能较少（这是正常的）
- [ ] 不应该报错

---

#### Task 4.3: 大量访谈Study测试
**状态**: [ ] 待开始  
**预计时间**: 15分钟

**步骤**:
如果有Study包含>10个访谈，测试生成Study总结

**验证**:
- [ ] 生成时间较长（1-2分钟）
- [ ] 不应该超时
- [ ] 生成的内容质量良好

---

### Phase 5: UI/UX优化（可选）

#### Task 5.1: 响应式测试
**状态**: [ ] 待开始  
**预计时间**: 15分钟

**步骤**:
在不同设备/屏幕尺寸下测试UI

**验证**:
- [ ] 移动端显示正常
- [ ] 平板显示正常
- [ ] 桌面端显示正常

---

#### Task 5.2: 加载状态优化
**状态**: [ ] 待开始  
**预计时间**: 10分钟

**检查**:
- [ ] 加载动画流畅
- [ ] 加载提示文案清晰
- [ ] 错误提示友好

---

### Phase 6: 性能测试（可选）

#### Task 6.1: 大数据量测试
**状态**: [ ] 待开始  
**预计时间**: 20分钟

**测试项**:
- [ ] Study包含>50个访谈时的加载性能
- [ ] API响应时间
- [ ] 前端渲染性能

---

### Phase 7: 文档完善（可选）

#### Task 7.1: 用户使用指南
**状态**: [ ] 待开始  
**预计时间**: 30分钟

**内容**:
- 如何查看访谈总结
- 如何生成Study总结
- 如何编辑总结
- 常见问题

---

## 📊 进度追踪

### 必须完成（核心功能）
- [ ] Phase 1: 数据库Migration
- [ ] Phase 2: 本地环境测试（Task 2.1-2.7）

**预计时间**: 1小时

### 建议完成（提升质量）
- [ ] Phase 3: 历史数据补充
- [ ] Phase 4: 边界情况测试

**预计时间**: 45分钟

### 可选完成（锦上添花）
- [ ] Phase 5: UI/UX优化
- [ ] Phase 6: 性能测试
- [ ] Phase 7: 文档完善

**预计时间**: 1.5小时

---

## 🚨 已知问题

### 1. Migration未执行
**状态**: 待处理  
**影响**: 阻塞所有功能  
**解决**: 执行Task 1.1

### 2. 短访谈可能生成失败
**状态**: 已知限制  
**影响**: <2分钟的访谈可能无法生成完整总结  
**解决**: 已放宽验证规则，支持1-5 insights, 2-10 quotes

---

## 💡 提示

1. **按顺序执行**：Phase 1必须先完成，否则无法测试
2. **检查日志**：遇到问题先查看后端日志
3. **多次测试**：不同长度、不同类型的访谈都要测试
4. **记录问题**：发现问题及时记录，方便后续优化

---

## 📁 相关文件

### 核心代码
```
backend/
├── migrations/001_add_summary_fields.sql    # Migration文件
├── src/
│   ├── controllers/analytics.controller.ts  # API endpoints
│   ├── services/
│   │   ├── interview-summary.service.ts     # 单访谈总结
│   │   └── study-summary.service.ts         # Study总结
│   ├── lib/prompts/
│   │   ├── generate-interview-summary.ts    # 单访谈Prompt
│   │   └── generate-study-summary.ts        # Study Prompt
│   └── scripts/
│       └── find-and-backfill.ts             # 历史数据补充

frontend/src/components/
├── call/
│   ├── KeyInsightsCard.tsx                  # Key Insights展示
│   ├── ImportantQuotesCard.tsx              # Important Quotes展示
│   └── callInfo.tsx                         # 单访谈页面
└── dashboard/interview/
    ├── StudySummaryCard.tsx                 # Study总结展示
    └── summaryInfo.tsx                      # Study页面
```

---

## ✅ 完成标准

当以下所有项都完成时，可以认为总结模块已完成：

- [ ] Migration执行成功
- [ ] 单访谈自动生成测试通过（至少3个访谈）
- [ ] Study总结生成测试通过（至少1个Study）
- [ ] 编辑功能测试通过
- [ ] 所有功能在浏览器中正常显示
- [ ] 没有控制台错误
- [ ] 后端日志正常

---

**开始执行吧！** 🚀

